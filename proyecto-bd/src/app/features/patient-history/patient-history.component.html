<div *ngIf="paciente">
    <div class="card border-primary mb-4">
        <div class="card-body d-flex justify-content-between align-items-center bg-light">
            <div>
                <h4 class="m-0 text-primary">{{ paciente.nombre }}</h4>
                <small class="text-muted">C.C. {{ paciente.cedula }} | Fecha Nac: {{ paciente.fecha_nacimiento }} |
                    Género: {{ paciente.genero }}</small>
            </div>
            <div>
                <button class="btn btn-outline-secondary btn-sm"
                    *ngIf="authService.getCurrentUser()?.rol === 'Administrador' || authService.getCurrentUser()?.rol === 'Archivista'"
                    (click)="openEditModal()"><i class="fas fa-edit"></i> Editar Datos</button>
                <button class="btn btn-outline-dark btn-sm" (click)="openSolicitudesModal()"><i
                        class="fas fa-file-contract"></i> Solicitudes</button>
            </div>
        </div>
    </div>

    <div class="card p-4">
        <h5 class="mb-3"><i class="fas fa-history"></i> Historial de Episodios Clínicos</h5>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th># Episodio</th>
                        <th>Fecha Apertura</th>
                        <th>Motivo de Consulta</th>
                        <th>Médico Responsable</th>
                        <th>Estado</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let episodio of episodios">
                        <td><strong>{{ episodio.num_episodio }}</strong></td>
                        <td>{{ episodio.fecha_apertura }}</td>
                        <td>{{ episodio.motivo_consulta }}</td>
                        <td>{{ episodio.id_medico }}</td>
                        <td>
                            <span class="badge rounded-pill"
                                [ngClass]="{'bg-success': episodio.estado === 'Abierto', 'bg-secondary': episodio.estado === 'Cerrado'}">
                                {{ episodio.estado }}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info text-white" (click)="verDetalle(episodio)">
                                <i class="fas fa-eye"></i> Ver Detalle
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Editar Datos -->
    <div class="modal" tabindex="-1" [ngClass]="{'d-block': showEditModal}" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Datos del Paciente</h5>
                    <button type="button" class="btn-close" (click)="closeEditModal()"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" [(ngModel)]="editPatient.nombre" name="nombre">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" [(ngModel)]="editPatient.fecha_nacimiento"
                                name="fechaNacimiento">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Género</label>
                            <select class="form-select" [(ngModel)]="editPatient.genero" name="genero">
                                <option value="M">Masculino</option>
                                <option value="F">Femenino</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Dirección</label>
                            <input type="text" class="form-control" [(ngModel)]="editPatient.direccion"
                                name="direccion">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancelar</button>
                    <button type="button" class="btn btn-primary" (click)="updatePatient()">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Solicitudes -->
    <div class="modal" tabindex="-1" [ngClass]="{'d-block': showSolicitudesModal}"
        style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Solicitudes y Trámites</h5>
                    <button type="button" class="btn-close" (click)="closeSolicitudesModal()"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <h6>Nueva Solicitud</h6>
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Descripción de la solicitud..."
                                [(ngModel)]="newSolicitud.descripcion">
                            <button class="btn btn-success" (click)="createSolicitud()">Crear</button>
                        </div>
                    </div>
                    <h6>Historial de Solicitudes</h6>
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center"
                            *ngFor="let sol of solicitudes">
                            {{ sol.descripcion }}
                            <span class="badge bg-secondary">{{ sol.fecha_solicitud }}</span>
                        </li>
                        <li class="list-group-item text-muted" *ngIf="solicitudes.length === 0">No hay solicitudes
                            registradas.</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeSolicitudesModal()">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
</div>